# Changelog

Все значимые изменения в проекте Shell MCP будут документированы в этом файле.

Формат основан на [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
и проект следует [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]

### Добавлено
- **Система временных и постоянных скриптов**:
  - Разделение скриптов на временные (в папке `tmp/`) и постоянные
  - Автоматическая очистка временных скриптов старше 3 дней
  - Возможность перевода временных скриптов в постоянные
- **Новые MCP инструменты для временных скриптов**:
  - `save_temp_script` - сохранение временного скрипта
  - `list_temp_scripts` - список временных скриптов
  - `promote_temp_script` - перевод временного скрипта в постоянный
  - `cleanup_old_temp_scripts` - очистка старых временных скриптов
- **Расширенная конфигурация**:
  - `TEMP_SCRIPTS_DIR` - папка для временных скриптов
  - `TEMP_SCRIPT_MAX_AGE_DAYS` - максимальный возраст временных скриптов
- **Индексация существующих файлов в ScriptStore**:
  - Новый метод `index_existing_files()` в классе `ScriptStore`
  - Автоматическое определение языка программирования по расширению файла
  - Поддержка Python (.py), Bash (.sh), Node.js (.mjs) файлов
  - Исключение служебных файлов (index.json) из индексации
- **Новый MCP инструмент `index_existing_scripts`**:
  - Индексация скриптов, созданных вне MCP системы
  - Возврат детальной информации о проиндексированных файлах
  - Обработка ошибок с понятными сообщениями
- **Расширенные тесты**:
  - Unit тесты для метода `index_existing_files()`
  - Тесты определения языка по расширению файла
  - Интеграционные тесты для нового MCP инструмента
- Полная структура тестирования согласно AGENTS.md
- Unit тесты для всех основных компонентов:
  - `DockerExecutor` - тесты инициализации, управления образами, выполнения кода
  - `ScriptStore` - тесты сохранения, получения, удаления скриптов
  - `RunCodeArgs` и `RunSavedArgs` - тесты валидации параметров
  - Мета-инструменты - тесты health и version
- Интеграционные тесты для проверки взаимодействия компонентов
- End-to-end сценарии для реальных случаев использования
- Конфигурация pytest с покрытием кода (coverage)
- Pre-commit hooks для автоматической проверки качества кода

### Изменено
- Обновлена конфигурация ruff для использования новой структуры `[tool.ruff.lint]`
- Исправлены все проблемы с форматированием кода (black, ruff)
- Исправлены все проблемы с типизацией (mypy)
- Интеграционные тесты теперь используют правильный API DockerExecutor

### Исправлено
- Исправлены ошибки импорта в тестах
- Исправлены проблемы с валидацией Pydantic в тестах
- Исправлены проблемы с доступом к инструментам FastMCP в тестах
- Исправлены проблемы с типизацией в DockerExecutor и ScriptStore
- Исправлены проблемы с форматированием кода

### Техническое качество
- Покрытие кода тестами: 68%
- Все инструменты качества кода настроены и работают:
  - `black` - форматирование кода
  - `ruff` - линтинг и проверка стиля
  - `mypy` - проверка типов
  - `pytest` - тестирование с покрытием
- Pre-commit hooks настроены для автоматической проверки
- 83 из 84 тестов проходят успешно (1 неудачный из-за сетевых проблем)

## [0.1.0] - 2024-01-XX

### Добавлено
- Базовая архитектура Shell MCP сервера
- DockerExecutor для выполнения кода в изолированных контейнерах
- ScriptStore для управления сохраненными скриптами
- MCP инструменты для выполнения кода
- Конфигурация через переменные окружения
- Поддержка Python, Bash, Node.js
- Система артефактов для экспорта файлов
