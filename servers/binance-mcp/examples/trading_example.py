#!/usr/bin/env python3
"""–ü—Ä–∏–º–µ—Ä—ã —Ç–æ—Ä–≥–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å Binance MCP —Å–µ—Ä–≤–µ—Ä–æ–º."""

import asyncio
import json
from src.services import OrderService
from src.models import CreateOrderRequest


async def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ —Ç–æ—Ä–≥–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π."""
    print("üí± –ü—Ä–∏–º–µ—Ä—ã —Ç–æ—Ä–≥–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π\n")
    
    try:
        # –í–ê–ñ–ù–û: –≠—Ç–æ –ø—Ä–∏–º–µ—Ä—ã –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏!
        # –í —Ä–µ–∞–ª—å–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–µ –±—É–¥—å—Ç–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã —Å –¥–µ–Ω—å–≥–∞–º–∏!
        print("‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ –ø—Ä–∏–º–µ—Ä—ã –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏!")
        print("‚ö†Ô∏è  –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–µ–Ω—å–≥–∏ –±–µ–∑ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è!\n")
        
        # –ü—Ä–∏–º–µ—Ä 1: –†—ã–Ω–æ—á–Ω—ã–π –æ—Ä–¥–µ—Ä –Ω–∞ –ø–æ–∫—É–ø–∫—É (–ù–ï –í–´–ü–û–õ–ù–Ø–ï–¢–°–Ø)
        print("üìà –ü—Ä–∏–º–µ—Ä 1: –†—ã–Ω–æ—á–Ω—ã–π –æ—Ä–¥–µ—Ä –Ω–∞ –ø–æ–∫—É–ø–∫—É 0.001 BTC")
        market_order = CreateOrderRequest(
            symbol="BTCUSDT",
            side="BUY",
            type="MARKET",
            quantity=0.001
        )
        print(f"–°–æ–∑–¥–∞–Ω –æ—Ä–¥–µ—Ä: {market_order.dict()}")
        print("(–û—Ä–¥–µ—Ä –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è - —ç—Ç–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∏–º–µ—Ä)\n")
        
        # –ü—Ä–∏–º–µ—Ä 2: –õ–∏–º–∏—Ç–Ω—ã–π –æ—Ä–¥–µ—Ä –Ω–∞ –ø—Ä–æ–¥–∞–∂—É (–ù–ï –í–´–ü–û–õ–ù–Ø–ï–¢–°–Ø)
        print("üìâ –ü—Ä–∏–º–µ—Ä 2: –õ–∏–º–∏—Ç–Ω—ã–π –æ—Ä–¥–µ—Ä –Ω–∞ –ø—Ä–æ–¥–∞–∂—É 0.001 BTC –ø–æ —Ü–µ–Ω–µ 60000 USDT")
        limit_order = CreateOrderRequest(
            symbol="BTCUSDT",
            side="SELL",
            type="LIMIT",
            quantity=0.001,
            price=60000.0,
            timeInForce="GTC"
        )
        print(f"–°–æ–∑–¥–∞–Ω –æ—Ä–¥–µ—Ä: {limit_order.dict()}")
        print("(–û—Ä–¥–µ—Ä –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è - —ç—Ç–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∏–º–µ—Ä)\n")
        
        # –ü—Ä–∏–º–µ—Ä 3: –°—Ç–æ–ø-–ª–æ—Å—Å –æ—Ä–¥–µ—Ä (–ù–ï –í–´–ü–û–õ–ù–Ø–ï–¢–°–Ø)
        print("üõë –ü—Ä–∏–º–µ—Ä 3: –°—Ç–æ–ø-–ª–æ—Å—Å –æ—Ä–¥–µ—Ä –¥–ª—è BTCUSDT")
        stop_order = CreateOrderRequest(
            symbol="BTCUSDT",
            side="SELL",
            type="STOP_MARKET",
            quantity=0.001,
            stopPrice=45000.0
        )
        print(f"–°–æ–∑–¥–∞–Ω –æ—Ä–¥–µ—Ä: {stop_order.dict()}")
        print("(–û—Ä–¥–µ—Ä –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è - —ç—Ç–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∏–º–µ—Ä)\n")
        
        # –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –æ—Ä–¥–µ—Ä–æ–≤
        print("üìã –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –æ—Ä–¥–µ—Ä–æ–≤ BTCUSDT...")
        try:
            order_history = await OrderService.get_order_history("BTCUSDT", 5)
            print(f"–ù–∞–π–¥–µ–Ω–æ {len(order_history)} –æ—Ä–¥–µ—Ä–æ–≤ –≤ –∏—Å—Ç–æ—Ä–∏–∏")
            for order in order_history[:3]:
                print(f"  {order.symbol}: {order.side} {order.type} - {order.origQty} (—Å—Ç–∞—Ç—É—Å: {order.status})")
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –æ—Ä–¥–µ—Ä–æ–≤: {e}")
        print()
        
        # –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å–¥–µ–ª–æ–∫
        print("üíº –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å–¥–µ–ª–æ–∫ BTCUSDT...")
        try:
            trade_history = await OrderService.get_trade_history("BTCUSDT", 5)
            print(f"–ù–∞–π–¥–µ–Ω–æ {len(trade_history)} —Å–¥–µ–ª–æ–∫ –≤ –∏—Å—Ç–æ—Ä–∏–∏")
            for trade in trade_history[:3]:
                print(f"  {trade.symbol}: {trade.side} - {trade.qty} –ø–æ —Ü–µ–Ω–µ {trade.price}")
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ —Å–¥–µ–ª–æ–∫: {e}")
        print()
        
        print("‚úÖ –ü—Ä–∏–º–µ—Ä—ã —Ç–æ—Ä–≥–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∑–∞–≤–µ—Ä—à–µ–Ω—ã!")
        print("üí° –î–ª—è —Ä–µ–∞–ª—å–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–µ–º–æ-—Ä–µ–∂–∏–º –∏–ª–∏ —Ç–µ—Å—Ç–æ–≤—É—é —Å–µ—Ç—å")
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")


if __name__ == "__main__":
    asyncio.run(main())
