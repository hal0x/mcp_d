# Backtesting MCP

MCP-—Å–µ—Ä–≤–µ—Ä –¥–ª—è –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–∞–∫ —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ, —Ç–∞–∫ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ –¥—Ä—É–≥–∏–µ MCP-—Å–µ—Ä–≤–µ—Ä—ã.

## üîå –°–µ—Ç–µ–≤–∞—è —Ç–æ–ø–æ–ª–æ–≥–∏—è

| Service | Port | Transport | Dependencies |
|---------|------|-----------|--------------|
| `binance-mcp` | `8000` | `stdio` | `redis`, `postgres` |
| `tradingview-mcp` | `8060` | `streamable-http` | `redis`, `postgres`, `binance-mcp`, `memory-mcp` |
| `memory-mcp` | `8050` | `stdio` | `redis` |
| `shell-mcp` | `8070` | `stdio` | `redis` |
| `backtesting-mcp` | `8082` | `stdio` | `postgres`, `binance-mcp`, `tradingview-mcp` |

> Backtesting MCP –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç HTTP-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞ `0.0.0.0:8082` –∏ –æ–∂–∏–¥–∞–µ—Ç TradingView MCP –ø–æ –∞–¥—Ä–µ—Å—É `http://tradingview-mcp:8060`.

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
uv sync --project backtesting-mcp

# –ò–ª–∏ —Å pip
pip install -e .
```

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------------|----------|--------------|
| `BACKTEST_DEFAULT_TIMEFRAME` | –¢–∞–π–º—Ñ—Ä–µ–π–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é | `1h` |
| `BACKTEST_PREFERRED_SOURCE` | –ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö: `binance`, `tradingview`, `both`, `synthetic` | `binance` |
| `BACKTEST_BINANCE_URL` | URL —Å–µ—Ä–≤–µ—Ä–∞ binance-mcp | `http://localhost:8000` |
| `BACKTEST_TRADINGVIEW_URL` | URL —Å–µ—Ä–≤–µ—Ä–∞ tradingview-mcp | `http://localhost:8060` |
| `BACKTEST_SEED` | –°–∏–¥ –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏ | `42` |
| `BACKTEST_MAX_CANDLES` | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–µ—á–µ–π | `10000` |
| `BACKTEST_REQUEST_TIMEOUT` | –¢–∞–π–º–∞—É—Ç HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ (—Å–µ–∫) | `15.0` |

## –ó–∞–ø—É—Å–∫

### Stdio (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
```bash
uv run --project backtesting-mcp backtesting-mcp --stdio
```

### HTTP
```bash
uv run --project backtesting-mcp backtesting-mcp --host 0.0.0.0 --port 8082
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```bash
uv run --project backtesting-mcp backtesting-mcp --print-config
```

## –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

### `run_backtest`
–ó–∞–ø—É—Å–∫–∞–µ—Ç –±—ç–∫—Ç–µ—Å—Ç —Ç–æ—Ä–≥–æ–≤–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `strategy` (str): –ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "ma_crossover")
- `symbol` (str): –¢–æ—Ä–≥–æ–≤—ã–π —Å–∏–º–≤–æ–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, "BTCUSDT")
- `timeframe` (str): –¢–∞–π–º—Ñ—Ä–µ–π–º ("1m", "5m", "15m", "1h", "4h", "1d")
- `start` (str): –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –≤ ISO —Ñ–æ—Ä–º–∞—Ç–µ
- `end` (str): –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –≤ ISO —Ñ–æ—Ä–º–∞—Ç–µ
- `parameters` (dict): –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

**–ü—Ä–∏–º–µ—Ä:**
```json
{
  "name": "run_backtest",
  "arguments": {
    "strategy": "ma_crossover",
    "symbol": "BTCUSDT",
    "timeframe": "1h",
    "start": "2023-01-01T00:00:00",
    "end": "2023-06-01T00:00:00",
    "parameters": {"fast": 12, "slow": 30}
  }
}
```

### `optimize_parameters`
–û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Å –ø–æ–º–æ—â—å—é —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `strategy` (str): –ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
- `symbol` (str): –¢–æ—Ä–≥–æ–≤—ã–π —Å–∏–º–≤–æ–ª
- `timeframe` (str): –¢–∞–π–º—Ñ—Ä–µ–π–º
- `start` (str): –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞
- `end` (str): –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è
- `parameter_space` (dict): –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è –ø–æ–∏—Å–∫–∞
- `objective` (str): –¶–µ–ª—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ ("return" –∏–ª–∏ "sharpe")
- `trials` (int): –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ (1-1000)

### `compare_strategies`
–°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –±—ç–∫—Ç–µ—Å—Ç–æ–≤.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `results` (list): –°–ø–∏—Å–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –±—ç–∫—Ç–µ—Å—Ç–æ–≤ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è

### `health`
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞ –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `check_data_sources` (bool): –ü—Ä–æ–≤–µ—Ä—è—Ç—å –ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö

### `version`
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–µ—Ä—Å–∏–∏ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞.

## –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö

–°–µ—Ä–≤–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ —Ä—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –¥—Ä—É–≥–∏—Ö MCP-—Å–µ—Ä–≤–µ—Ä–æ–≤ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö:

1. **Binance MCP** - —á–µ—Ä–µ–∑ `binance-mcp`
2. **TradingView MCP** - —á–µ—Ä–µ–∑ `tradingview-mcp`
3. **–°–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ** - –µ—Å–ª–∏ –≤–Ω–µ—à–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Claude Desktop

–î–æ–±–∞–≤—å—Ç–µ –≤ `claude_desktop_config.json`:

```json
{
  "mcpServers": {
    "backtesting-mcp": {
      "command": "uv",
      "args": ["run", "--project", "/path/to/backtesting-mcp", "backtesting-mcp", "--stdio"],
      "env": {
        "BACKTEST_PREFERRED_SOURCE": "binance"
      }
    }
  }
}
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ë–∞–∑–æ–≤—ã–π –±—ç–∫—Ç–µ—Å—Ç
```python
# –ß–µ—Ä–µ–∑ MCP –∫–ª–∏–µ–Ω—Ç
result = client.call_tool("run_backtest", {
    "strategy": "ma_crossover",
    "symbol": "BTCUSDT",
    "timeframe": "1h",
    "start": "2023-01-01T00:00:00",
    "end": "2023-06-01T00:00:00",
    "parameters": {"fast": 10, "slow": 30}
})
print(f"–û–±—â–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å: {result['metrics']['total_return']:.2%}")
print(f"–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –®–∞—Ä–ø–∞: {result['metrics']['sharpe']:.2f}")
```

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
```python
result = client.call_tool("optimize_parameters", {
    "strategy": "ma_crossover",
    "symbol": "BTCUSDT",
    "parameter_space": {
        "fast": [5, 10, 15, 20],
        "slow": [20, 30, 40, 50]
    },
    "objective": "sharpe",
    "trials": 50
})
print(f"–õ—É—á—à–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: {result['best_params']}")
print(f"–õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: {result['best_score']:.4f}")
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

- `src/backtesting_mcp/server.py` - –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ MCP-—Å–µ—Ä–≤–µ—Ä–∞
- `src/backtesting_mcp/tools/` - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ MCP
- `src/backtesting_mcp/services/` - –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç MCP
- `src/backtesting_mcp/config.py` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `src/backtesting_mcp/datasource.py` - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö
