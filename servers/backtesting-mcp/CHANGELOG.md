# Changelog

Все значимые изменения в проекте Backtesting MCP Server документируются в этом файле.

Формат основан на [Keep a Changelog](https://keepachangelog.com/ru/1.0.0/),
и проект следует [Semantic Versioning](https://semver.org/lang/ru/).

## [Unreleased]

### Исправлено
- Исправлена ошибка оптимизации параметров при отсутствии значений в `parameter_space` — теперь используются значения по умолчанию
- Улучшена обработка пустых или неполных пространств параметров в методе `_normalize_parameter_space`

---

## [0.2.0] - 2025-10-22

### Добавлено
- Интеграция с Optuna (>=3.6.0) для продвинутой оптимизации параметров
- Подключение PostgreSQL storage для хранения Optuna-исследований
- Поддержка конфигурации Optuna через переменные окружения `BACKTEST_OPTUNA_*`
- Возврат расширенной метадаты `optuna` в ответах инструмента `optimize_parameters`
- Новые зависимости: `optuna-dashboard` (для будущей визуализации) и `psycopg2-binary`

### Изменено
- Сервис оптимизации переписан на Optuna study (TPE по умолчанию вместо случайного поиска)
- Инструмент `optimize_parameters` обновлён для работы с Optuna и сохранения истории trial'ов
- Компонент `BacktestingService` получает настройки Optuna при инициализации из конфигурации
- Документация (`AGENTS.md`) отражает новую архитектуру и переменные окружения

### Исправлено
- Логи оптимизации теперь корректно отражают отсутствие успешных trial'ов

---

## [0.1.0] - 2024-12-19

### Добавлено
- Первоначальный релиз Backtesting MCP Server
- Инструменты для бэктестинга торговых стратегий:
  - `run_backtest` — запуск бэктеста стратегии пересечения скользящих средних
  - `optimize_parameters` — оптимизация параметров стратегии случайным поиском
  - `compare_strategies` — сравнение результатов нескольких бэктестов
  - `health` — проверка состояния сервера и внешних источников данных
  - `version` — получение информации о версии и конфигурации
- Поддержка синтетических данных для автономной работы
- Интеграция с внешними MCP серверами (Binance, TradingView)
- Graceful fallback к синтетическим данным при недоступности внешних источников
- Конфигурация через переменные окружения с префиксом `BACKTEST__`
- Поддержка stdio и HTTP режимов запуска
- Структурированное логирование с настраиваемыми уровнями

### Архитектура
- Чистая архитектура с разделением на слои:
  - `services/` — бизнес-логика без зависимостей от MCP
  - `tools/` — MCP инструменты и модели валидации
  - `datasource.py` — интеграция с внешними источниками данных
  - `server.py` — точка входа MCP сервера
- Типизация с использованием Pydantic для валидации параметров
- Детерминированная генерация синтетических данных

### Технические детали
- Python 3.11+ с современным стеком (FastMCP, Pydantic 2.x, httpx, pandas, numpy)
- Централизованная конфигурация через pydantic-settings
- HTTP клиент с тайм-аутами для внешних API
- CLI интерфейс с поддержкой различных режимов запуска

---

## [Unreleased]

### Планируется
- Расширение списка торговых стратегий (RSI, Bollinger Bands, волновые модели)
- Добавление тестовой матрицы
- Поддержка пользовательских стратегий через плагины
- Кеширование исторических данных
- Интеграция с дополнительными источниками данных (Bybit, Coinbase)
- Мониторинг и метрики производительности
