#!/bin/bash

# üîß –°–∫—Ä–∏–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ MCP –∫–ª–∏–µ–Ω—Ç–∞

set -e

echo "üîß –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ MCP –∫–ª–∏–µ–Ω—Ç–∞..."

# –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
PROJECT_DIR=$(pwd)
VENV_PYTHON="$PROJECT_DIR/.venv/bin/python"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
if [ ! -f "scripts/mcp_server.py" ]; then
    echo "‚ùå –°–∫—Ä–∏–ø—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω –∏–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞"
    echo "üí° –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–Ω–æ–≤–∞"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
if [ ! -f "$VENV_PYTHON" ]; then
    echo "‚ùå –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ .venv/"
    echo "üí° –°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ: python -m venv .venv"
    exit 1
fi

# –°–æ–∑–¥–∞—ë–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é MCP
read -r -d '' MCP_CONFIG <<EOF || true
{
  "mcpServers": {
    "memory-mcp": {
      "command": "$VENV_PYTHON",
      "args": ["scripts/mcp_server.py"],
      "cwd": "$PROJECT_DIR",
      "env": {
        "PYTHONPATH": "$PROJECT_DIR"
      }
    }
  },
  "clients": {
    "cursor": {
      "mcpServers": {
        "memory-mcp": {
          "command": "$VENV_PYTHON",
          "args": ["scripts/mcp_server.py"],
          "cwd": "$PROJECT_DIR",
          "env": {
            "PYTHONPATH": "$PROJECT_DIR"
          }
        }
      }
    }
  }
}
EOF

echo "‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è MCP —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞!"
echo ""
echo "üìã –î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ –≤–∞—à MCP –∫–ª–∏–µ–Ω—Ç:"
echo ""
echo "$MCP_CONFIG"
echo ""
echo "üìÅ –ü—É—Ç—å –∫ –ø—Ä–æ–µ–∫—Ç—É: $PROJECT_DIR"
echo "üêç Python –∏–∑ venv: $VENV_PYTHON"
echo ""
echo "üí° –î–ª—è Cursor –¥–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ –≤ ~/.cursor/mcp.json"
echo "üí° –î–ª—è –¥—Ä—É–≥–∏—Ö MCP –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª"
echo ""
echo "üöÄ –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –≤–∞—à MCP –∫–ª–∏–µ–Ω—Ç"
