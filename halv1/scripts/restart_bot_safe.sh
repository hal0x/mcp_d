#!/bin/bash
# –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å–µ—Å—Å–∏–∏ Telethon

echo "üîÑ –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞ halv1"
echo "===================================="

# –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
source venv/bin/activate

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø—É—â–µ–Ω –ª–∏ –±–æ—Ç
BOT_PID=$(pgrep -f "python.*main.py")
if [ -n "$BOT_PID" ]; then
    echo "–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–ø—É—â–µ–Ω–Ω–æ–≥–æ –±–æ—Ç–∞ (PID: $BOT_PID)..."
    kill $BOT_PID
    sleep 2
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
    if pgrep -f "python.*main.py" > /dev/null; then
        echo "–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞..."
        pkill -f "python.*main.py"
        sleep 1
    fi
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–µ—Å—Å–∏—é Telethon
echo "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏ Telethon..."
python scripts/telethon_auth_simple.py > /dev/null 2>&1

if [ $? -eq 0 ]; then
    echo "‚úÖ –°–µ—Å—Å–∏—è Telethon —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ"
else
    echo "‚ùå –ü—Ä–æ–±–ª–µ–º–∞ —Å —Å–µ—Å—Å–∏–µ–π Telethon"
    echo "–í—ã–ø–æ–ª–Ω–∏—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é:"
    echo "  ./scripts/auth_telethon_final.sh"
    exit 1
fi

# –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç
echo "–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞..."
python main.py
