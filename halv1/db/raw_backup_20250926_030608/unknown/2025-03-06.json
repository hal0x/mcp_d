{"id": 276506, "text": "package auto.common.model\n\nimport auto.common.model.CarIdentifier\nimport auto.common.model.vin.VinCode\nimport auto.common.utils.plate.LicensePlateUtils\nimport zio.test._\nimport zio.test.Assertion._\n\nobject CarIdentifierSpec extends ZIOSpecDefault {\n\n  private def identifierHasValidVinCode(identifier: CarIdentifier): Boolean =\n    identifier.vinCode.exists {\n      case v: VinCode.CommonVinCode => v.isChecksumCorrect\n      case _: VinCode.JDMCode       => true\n    }\n\n  private def identifierHasVin(identifier: CarIdentifier, vin: String): Boolean =\n    identifier.vin.contains(vin)\n\n  override def spec = suite(\"CarIdentifierSpec\")(\n\n    test(\"should parse valid VIN correctly\") {\n      val vins = List(\"WBA1A310X0JAA7149\", \"KL90E3ABDDCB9K701\", \"DC4GM166X3T028321\")\n      val identifiers = vins.map(CarIdentifier.parse)\n\n      assertTrue(\n        identifiers.forall(_.exists(id => identifierHasValidVinCode(id) && vins.contains(id.vin.getOrElse(\"\"))))\n      )\n    },\n\n    test(\"should parse valid License Plate correctly\") {\n      val lpStrs = List(\"A123BC77\", \"X999XX199\", \"М123ММ750\")\n      val identifiers = lpStrs.map(CarIdentifier.parse)\n\n      assertTrue(\n        identifiers.forall(_.exists(_.licencePlateCode.exists(_.isValid)))\n      )\n    },\n\n    test(\"should not parse invalid VIN\") {\n      val invalidVins = List(\"INVALIDVIN123456\", \"1234567890123456\", \"XYZ00000000000000\")\n      val identifiers = invalidVins.map(CarIdentifier.parse)\n\n      assertTrue(identifiers.forall(_.flatMap(_.vinCode).isEmpty))\n    },\n\n    test(\"should parse and normalize license plates\") {\n      val rawLps = List(\" а123вс 77 \", \" х999хх 199 \", \" м123мм 750 \")\n      val normalizedLps = List(\"A123BC77\", \"X999XX199\", \"M123MM750\")\n      val identifiers = rawLps.map(CarIdentifier.parse)\n\n      assertTrue(\n        identifiers.zip(normalizedLps).forall { case (id, normLp) =>\n          id.exists(_.licencePlateCode.exists(_.toString == normLp))\n        }\n      )\n    },\n\n    test(\"parse method should handle VIN correctly\") {\n      val vins = List(\"DC4GM166X3T028321\", \"JHMFA16586S000000\", \"VF7XSRHKHAA123456\")\n      val parsed = vins.map(CarIdentifier.parse)\n\n      assertTrue(\n        parsed.forall(_.exists(_.vinCode.exists(_.isCommon))),\n        parsed.forall(_.flatMap(_.licencePlate).isEmpty)\n      )\n    },\n\n    test(\"should not parse VIN as license plate\") {\n      val vins = List(\"KL90E3ABDDCB9K701\", \"W0L0ZCF6881100000\", \"JMBSREISAFY000883\")\n      val parsed = vins.map(CarIdentifier.parse)\n\n      assertTrue(\n        parsed.forall(_.exists(_.vinCode.nonEmpty)),\n        parsed.forall(_.exists(_.licencePlateCode.isEmpty))\n      )\n    },\n\n    test(\"parse ambiguous inputs as license plates first\") {\n      val ambiguousStrs = List(\"A123BC77\", \"M555MM55\", \"H001HH01\")\n      val parsed = ambiguousStrs.map(CarIdentifier.parse)\n\n      assertTrue(\n        parsed.forall(_.exists(_.licencePlateCode.exists(_.isValid))),\n        parsed.forall(_.exists(_.vinCode.isEmpty))\n      )\n    },\n\n    test(\"should correctly construct identifier with parse method\") {\n      val inputs = List(\"WBA1A310X0JAA7149\", \"X777XX77\", \"XYZ9999\")\n      val results = inputs.map(CarIdentifier.parse)\n\n      assertTrue(\n        results(0).exists(_.vinCode.nonEmpty),\n        results(1).exists(_.licencePlateCode.nonEmpty),\n        results(2).isEmpty\n      )\n    }\n  )\n}", "date": "2025-03-06T08:47:14+00:00", "chat": "unknown"}
