# üì± –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —Ç–æ—Ä–≥–æ–≤—ã–µ –∞–ª–µ—Ä—Ç—ã –≤ Telegram

## üéØ –û–±–∑–æ—Ä

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç–æ—Ä–≥–æ–≤—ã—Ö –∞–ª–µ—Ä—Ç–æ–≤ —Å –∫–Ω–æ–ø–∫–∞–º–∏ –¥–ª—è Telegram –±–æ—Ç–∞ HALv1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å, –æ—Ç–∫–ª–æ–Ω—è—Ç—å –∏–ª–∏ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –¥–µ—Ç–∞–ª–∏ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤ –ø—Ä—è–º–æ –≤ —á–∞—Ç–µ.

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üéÆ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
- **‚úÖ –í–∑—è—Ç—å** - –ø—Ä–∏–Ω—è—Ç—å —Ç–æ—Ä–≥–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª
- **‚ùå –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å** - –æ—Ç–∫–ª–æ–Ω–∏—Ç—å —Å–∏–≥–Ω–∞–ª  
- **üìä –î–µ—Ç–∞–ª–∏** - –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é

### üìä –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤
- –ö—Ä–∞—Å–∏–≤–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å —ç–º–æ–¥–∑–∏
- –¶–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è (üü¢ Long / üî¥ Short)
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–∏—á–∏–Ω —Å–∏–≥–Ω–∞–ª–∞
- HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏

### üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- API endpoint –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å PostgreSQL
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **TradingAlertHandler** (`halv1/bot/trading_alert_handler.py`)
   - –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞–ª–µ—Ä—Ç–æ–≤
   - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
   - –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ callback'–æ–≤

2. **BroadcastExecutor** (–æ–±–Ω–æ–≤–ª–µ–Ω –≤ `halv1/bot/telegram_bot.py`)
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å TradingAlertHandler
   - Fallback –∫ –ø—Ä–æ—Å—Ç—ã–º —Å–æ–æ–±—â–µ–Ω–∏—è–º
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

3. **API Endpoints** (`halv1/web/dashboard/server.py`)
   - `POST /api/trading-alert` ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–∏–≥–Ω–∞–ª –∏ —Ä–∞—Å—Å—ã–ª–∞–µ—Ç –µ–≥–æ –≤ Telegram
   - `GET /api/trading-alert/{id}` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π —Å–∏–≥–Ω–∞–ª (–∫–Ω–æ–ø–∫–∞ ‚Äú–î–µ—Ç–∞–ª–∏‚Äù)
   - `POST /api/trading-feedback` ‚Äî —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

4. **Callback Handlers** (–≤ `TelegramBot`)
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π –Ω–∞ –∫–Ω–æ–ø–∫–∏
   - –†–æ—É—Ç–∏–Ω–≥ –∫ TradingAlertHandler

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –ß–∞—Ç, –∫—É–¥–∞ –±–æ—Ç –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–∏–≥–Ω–∞–ª—ã
export TRADING_ALERT_CHAT_ID="123456789"

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –æ–±—â–µ–π –ë–î (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é postgresql://mcp:mcp@postgres:5432/mcp)
export HAL_TRADING_STORAGE_DSN="postgresql://mcp:mcp@postgres:5432/mcp"

# URLs —Å–µ—Ä–≤–∏—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –æ–±–æ–≥–∞—â–µ–Ω–∏—è
export HAL_TRADING_BINANCE_URL="http://binance-mcp:8000"
export HAL_TRADING_API_URL="http://halv1-dashboard:8001"

# –ó–∞–ø—É—Å–∫ dashboard (–ø–æ—Ä—Ç –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å)
uvicorn halv1.web.dashboard.server:app --reload --port 8001
```

### 2. –û—Ç–ø—Ä–∞–≤–∫–∞ –∞–ª–µ—Ä—Ç–∞

```python
# –ü—Ä–∏–º–µ—Ä –∞–ª–µ—Ä—Ç–∞ –æ—Ç tradingview-mcp
alert_payload = {
    "id": "12345",
    "symbol": "BTCUSDT", 
    "timeframe": "15m",
    "direction": "long",
    "entry": 45000.50,
    "confidence": 78,
    "reasons": ["breakout", "volume_spike"]
}

# –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ HALv1 API
await broadcast_executor.broadcast_trade_signal(alert_payload)
```

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –¥–µ—Ç–∞–ª–∏

- –ö–∞–∂–¥—ã–π —Å–∏–≥–Ω–∞–ª —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ `trading_alerts`, –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å ‚Äî –≤ `trading_feedback`.
- –î–µ—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ `GET /api/trading-alert/{id}` –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ Telegram –ø–æ –∫–Ω–æ–ø–∫–µ **üìä –î–µ—Ç–∞–ª–∏**.
- `POST /api/trading-feedback` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –¥–µ–π—Å—Ç–≤–∏—è `take` / `skip` –∏ –ø–∏—à–µ—Ç –∏—Ö –≤ –±–∞–∑—É.

## üì± –ü—Ä–∏–º–µ—Ä—ã —Å–æ–æ–±—â–µ–Ω–∏–π

### Long —Å–∏–≥–Ω–∞–ª
```
üü¢ –¢–æ—Ä–≥–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª

üìä –°–∏–º–≤–æ–ª: BTCUSDT
‚è∞ –¢–∞–π–º—Ñ—Ä–µ–π–º: 15m
üìà –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: LONG
üí∞ –í—Ö–æ–¥: 45000.5000
üéØ –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: 78%

–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:

üîç –ü—Ä–∏—á–∏–Ω—ã: breakout, volume_spike, ema_cross

[‚úÖ –í–∑—è—Ç—å] [‚ùå –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å]
[üìä –î–µ—Ç–∞–ª–∏]
```

### Short —Å–∏–≥–Ω–∞–ª
```
üî¥ –¢–æ—Ä–≥–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª

üìä –°–∏–º–≤–æ–ª: ETHUSDT
‚è∞ –¢–∞–π–º—Ñ—Ä–µ–π–º: 1h
üìà –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: SHORT
üí∞ –í—Ö–æ–¥: 3200.7500
üéØ –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: 85%

–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:

üîç –ü—Ä–∏—á–∏–Ω—ã: momentum, volume

[‚úÖ –í–∑—è—Ç—å] [‚ùå –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å]
[üìä –î–µ—Ç–∞–ª–∏]
```

## üîß –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
cd halv1
python tests/integration/test_interactive_alerts_simple.py

# –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç (—Ç—Ä–µ–±—É–µ—Ç python-telegram-bot)
python tests/integration/test_interactive_alerts.py
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```
‚úÖ TradingAlertHandler —Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º–∏ –∫–Ω–æ–ø–∫–∞–º–∏
‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤  
‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã —Å –∫–Ω–æ–ø–∫–∞–º–∏
‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ callback'–æ–≤ (take/skip/details)
‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ feedback —á–µ—Ä–µ–∑ API
‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å TelegramBot
‚úÖ API endpoint –¥–ª—è feedback –≤ HALv1
```

## üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### Callback Data Format
```
take_12345    -> action="take", signal_id="12345"
skip_67890    -> action="skip", signal_id="67890"  
details_11111 -> action="details", signal_id="11111"
```

### API Endpoints

**POST /api/trading-feedback**
```json
{
    "signal_id": 12345,
    "action": "take"
}
```

**Response:**
```json
{
    "status": "ok",
    "message": "Feedback received"
}
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

- Fallback –∫ –ø—Ä–æ—Å—Ç—ã–º —Å–æ–æ–±—â–µ–Ω–∏—è–º –µ—Å–ª–∏ python-telegram-bot –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- Graceful degradation –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö API
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

## üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å TradingView MCP

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–æ—É—Ç–∏–Ω–≥–∞ –∞–ª–µ—Ä—Ç–æ–≤

```yaml
# configs/infrastructure.yaml
halv1_bot:
  url: http://halv1-dashboard:8001/api/trading-alert
  timeout: 10
```

### –û—Ç–ø—Ä–∞–≤–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤

```python
# –í tradingview-mcp
from .alerts.router import AlertRouter

alert_router = AlertRouter(config.halv1_bot)
await alert_router.dispatch(signal)
```

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```python
# –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
logger.info(f"Interactive trading alert sent for {symbol}")
logger.info(f"Feedback saved: signal_id={signal_id}, action={action}")
logger.error(f"Failed to send trading alert: {error}")
```

### –ú–µ—Ç—Ä–∏–∫–∏

- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –∞–ª–µ—Ä—Ç–æ–≤
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–∞–∂–∞—Ç–∏–π –∫–Ω–æ–ø–æ–∫ (take/skip/details)
- –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ –Ω–∞ –∞–ª–µ—Ä—Ç—ã
- –û—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏

## üö® Troubleshooting

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **–ö–Ω–æ–ø–∫–∏ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É python-telegram-bot
   - –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ InlineKeyboardMarkup –¥–æ—Å—Ç—É–ø–µ–Ω

2. **Callback'–∏ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é CallbackQueryHandler
   - –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ _broadcast_executor –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω

3. **Feedback –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å HALv1 API –Ω–∞ –ø–æ—Ä—Ç—É 8001
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤

### –û—Ç–ª–∞–¥–∫–∞

```python
# –í–∫–ª—é—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
import logging
logging.getLogger("halv1.bot.trading_alert_handler").setLevel(logging.DEBUG)
```

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å PostgreSQL** - –ø–æ–ª–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ feedback –≤ –ë–î
2. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –¥–µ—Ç–∞–ª–∏** - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
3. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** - –¥–∞—à–±–æ—Ä–¥ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
4. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
5. **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —Ç–∏–ø–æ–≤ –∞–ª–µ—Ä—Ç–æ–≤

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 2025-01-18
